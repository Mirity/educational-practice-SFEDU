# 7 MVC JS - Alisa

# Версия Node 
v16.13.2

# Используемые библиотеки
- body-parser: 1.20.0,
-  dotenv: 16.0.2,
-  express: 4.18.1,
-  liquidjs: 9.42.0,
-  mysql-await: 2.2.2

# Задание
Создание MVC приложения на JS на основе базы данных из 4 раздела. В данном случае база данных сервисных центров.

# Как запустить приложение 
1. Переименовать .env.sample в .env в корневой директории
2. Вписать в файл .env недостающую информацию: DB_NAME, DB_USER, DB_PASSWORD
3. Написать команду gulp в консоль

# Страницы сайта
1. Машины
2. Сервисные центры
3. Клиент
4. Записи на обслуживание
5. Мастеры
6. Машина
7. Сервисный центр
8. Клиент
9. Запись на обслуживания
10. Мастер

На страницах машины, сервисные центры, клиенты, записи на обслуживание, мастеры есть форма для добавления новой записи и ссылка на экземпляр записи.
У записей машины, клиенты есть ссылка на страницы с изменением записи.
У экземпляров записей на обслуживание, мастеров есть кнопка удаления.

# index.js

Точка входа в приложения. В нем инициализируется liquid, body-parser, роутеры с помощью методов класса App.

# Описание классов 

## Класс App
Класс для взаимодействия с express, liquid, body-parser библиотек.

### Методы
    listen(port) {}

    initRouter (router) {}

    initBodyParser() {}

    initLiquid() {}

В этих методах инициализируются router с помозью express, body-parser, liquid.

## Класс Database
Класс для подключения и взамодествия к базе данных.

### Методы
    static getConnection() {}

    static makeQuery(query, params) {}

- getConnection метод для подключения к базе данных.
- makeQuery метод для того, чтобы сделать запрос к базе данных. В параметрах передается текст запроса и параметры для него, если требуются(например, для select).

## Классы Controller

### AbstractController 

Абстрактный контроллер

#### Методы 

    async execute(req, res, next) {}

    handleInvalidId (res) {}

    isCorrectId (id) {}

Метод execute является асинхронным. Является родительским классом для всех остальных контроллеров. Вызывается при вызове определенного роута. 
Вызывает методы postHandler или getHandler дочернего класса в зависимости от типа запроса POST или GET соответсвенно.

handleInvalidId обрабатывает поведение приложения при неверно введенном id в URL при GET запросе на одну запись.

isCorrectId проверяет верность введенного id.

### Controller 
#### Методы
    async getHandler (res, req) {}

    async postHandler (res, req) {}

getHandler обрабатывает GET запрос. 
Вызывает метод класса resource определенной сущности, 
который делает select запрос в базу данных.
Отправляет данные в класс View.


postHandler обрабатывает POST запрос.
Вызывает метод класса resource определенной сущности, 
который делает insert into запрос в базу данных.
Совершает redirect на страницу сущности.

### DeleteController
#### Методы
    async getHandler (res, req) {}

getHandler обрабатывает GET запрос.
Вызывает метод класса resource определенной сущности,
который делает delete запрос в базу данных.

### EditController
#### Методы
    async getHandler (res, req) {}

    async postHandler (res, req) {}

getHandler обрабатывает GET запрос.
Вызывает метод класса resource определенной сущности,
который делает select запрос в базу данных.
Отправляет данные в класс View.


postHandler обрабатывает POST запрос.
Вызывает метод класса resource определенной сущности,
который делает update запрос в базу данных.
Совершает redirect на страницу сущности.

## Классы Router
### AbstractRouter
Класс для обработки роутера, какой контроллер отвечает за обработку определенного роута.
### Router
Наследуется от AbstractRouter
#### Массив routes
controller: экземпляр класса контроллера, который отвечает за обработку пути

path: путь

method: тип запроса post или get
#### Constructor
В конструкторе вызывается метод createRoutes
родительского класса, в который передается массив routes.


## Resource models
Непосредственно совершает запрос в базу данных с помощью метода makeQuery класса Database.
Возвращает массив данных или элемент массива, если это запрос для экземпляра сущности,
делает это при get запросе.

Есть методы get, add, delete и edit.

## Классы view

Отвечает за передачу даннх в template.

### AbstractView
Родительский класс для остальных классов View

#### Методы
    getTemplate() {}

    setTemplate(template) {}

getTemplate возвращает template(название liquid файла). 

setTemplate устанавливает значение template

### View
Дочерний класс AbstractView
#### Методы
    getСущность() {}

    setСущность(данные) {}


getСущность возвращает массив данных.

setСущность устанавливает значение данныхю